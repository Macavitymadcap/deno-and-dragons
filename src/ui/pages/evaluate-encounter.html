<div class="card">
  <h2>Encounter Evaluator</h2>
  <div class="evaluator">
    <fieldset>
      <legend>
        Party
      </legend>
      <span class="centred">
        <label for="level-input">
          Level
          <input type="number" name="level-input" />
        </label>
        <button
          _="on click
                set level to the (value of the previous <input/>)
                if level is not empty
                    make a <span.chip/> called levelChip
                    make a <span.chip-label/> called levelLabel
                    set levelLabel.innerHTML to level
                    put levelLabel at the start of levelChip
                    
                    make a <button.destructive/> called deleteLevelButton
                    set deleteLevelButton's innerHTML to '&#10006;' 
                    set deleteLevelButton's @_ to 'on click remove closest <span.chip/>'
                    set deleteLevelButton's @title to 'Remove Party Member'
                    put deleteLevelButton at the end of levelChip
                    put levelChip at the end of the next <output/>
                end"
        >
          &#65291;
        </button>
      </span>
      <output id="party-output" class="centred"></output>
    </fieldset>
    <fieldset>
      <legend>
        Opponents
      </legend>
      <span class="centred">
        <label for="xp-input">
          XP
          <input type="number" name="xp-input" />
        </label>
        <button
          _="on click
                set xp to the (value of the previous <input/>)
                if xp is not empty
                    make a <span.chip/> called xpChip
                    make a <span.chip-label/> called xpLabel
                    set xpLabel.innerHTML to xp
                    put xpLabel at the start of xpChip
                    
                    make a <button.destructive/> called deletexpButton
                    set deletexpButton's innerHTML to '&#10006;' 
                    set deletexpButton's @_ to 'on click remove closest <span.chip/>'
                    set deletexpButton's @title to 'Remove Opponent'
                    put deletexpButton at the end of xpChip
                    put xpChip at the end of the next <output/>
                end"
        >
          &#65291;
        </button>
      </span>
      <output id="opponents-output" class="centred"></output>
    </fieldset>
    <button
      id="evaluate-button"
      _="on click
          set party to the children of #party-output
          set opponents to the children of #opponents-output
          if party is not empty and opponents is not empty
            set levels to []
            repeat for member in party
              get the (textContent of <span.chip-label/> in member) as an Int
              append the result to levels
            end

            set xp to []
            repeat for opponent in opponents
              get the (textContent of <span.chip-label/> in opponent) as an Int
              append the result to xp
            end

            call evaluateEncounter(levels, xp)
            set evaluation to the result
            make a <dl/> called evaluationDescription

            make a <dt/> called difficultyTerm
            set it's textContent to 'Difficulty'
            put it at the end of evaluationDescription
            make a <dd/> called difficultyDescription
            set it's textContent to evaluation.difficulty
            put it at the end of evaluationDescription

            make a <dt/> called actualXpTerm
            set it's textContent to 'Actual XP'
            put it at the end of evaluationDescription
            make a <dd/> called actualXpDescription
            set it's textContent to evaluation.actualXp
            put it at the end of evaluationDescription

            make a <dt/> called adjustedXpTerm
            set it's textContent to 'Adjusted XP'
            put it at the end of evaluationDescription
            make a <dd/> called adjustedXpDescription
            set it's textContent to evaluation.adjustedXp
            put it at the end of evaluationDescription

            put evaluationDescription into #evaluation
          end"
    >
      Evaluate
    </button>
    <output id="evaluation"></output>
  </div>
</div>
